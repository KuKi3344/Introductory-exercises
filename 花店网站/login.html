<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport"
			content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=yes">
		<title>LuLu花房(*￣▽￣*)ブ欢迎您</title>
		<link rel="stylesheet" href="./css/login.css" />
		<link rel="stylesheet" href="./css/bk.css" />
		<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
		<script type="text/javascript" src="./js/vue.js"></script>
		<script type="text/javascript" src="./js/cookie_utils.js" ></script>
		<script src="https://unpkg.com/element-ui/lib/index.js"></script>
		
	</head>
	<body>
		<div :class="{bk:noon,bknight:night}" id="container">
			<div id="particles-js"></div>
			<div class = "left">
			<div class="box1">
			<h1 class="h1">Welcome!</h1>
			<a href="#" class="link1">Select?</a>
			</div>
			
			<div class="box2">
			<h1 class="h2">Do you have an account?</h1>
			<a href="#" class="link2">Regist?</a>
			</div>
			
			<div class="box3">
			<h1 class="h3">Choose your like</h1>
			<a href="#" class="link3">About?</a>
			</div>
			</div>
			<button class = "night" v-if="noon" @click="tonight">夜间模式</button>
			<button class = "night" v-else @click="tonight">白日模式</button>
			<div :class="{box:noon,nibox:night}">
				<div class="Login">
					<form>
						<label for="name" :class= "{label:noon,nilabel:night}">Username</label>

						<input type="text" v-model="name" :class="{input:noon,niinput:night}" placeholder="请输入用户名" @keyup="checkInfo">

						<label for="password" :class= "{label:noon,nilabel:night}">Password</label>

						<input type="password" v-model="password" :class="{input:noon,niinput:night}" placeholder="请输入密码" @keyup="checkInfo">
						
						<label for="verify" :class= "{label:noon,nilabel:night}">验证码</label>
						
						<input type="text" v-model="verify" :class="{input:noon,niinput:night}" placeholder="请输入验证码" @keyup="checkInfo">
						
						<div class="code" id="checkCode" @click="createCode" ></div>
						<a  @click="createCode">看不清换一张</a>
					
					</form>
					<button :class="{bt1:noon,nibt1:night}" type="button"
						onclick="javascript:window.location.href='regist.html'">注册</button>
					<div id="tips">{{tips}}</div>
					<button :class="{bt2:noon,nibt2:night}" type="button" @click="doSubmit">登录</button>
				</div>

			</div>
			<div class="picture">
				<img class="f1" src="https://pics.prcm.jp/3a638fefa1001/75420560/png/75420560_220x200.png" />
				<img class="f2" src="https://www.haoy99.com/FileUpload/2018-11/7-60Zhang_Bei_Jing_Tou-102413_132.png" />
				<img class="f3" src="https://pics.prcm.jp/3a638fefa1001/75420559/png/75420559_220x113.png" />
			</div>
			<div class="footer">Created by LULU @2021.</div>
		</div>
		<script type="text/javascript">
			var vm = new Vue({
				el: "#container",
				data: {
					name:"",
					password: "",
					verify:"",
					img:"./img/head.png",
					tips: "",
					isRight:false,		
					noon:true,
					night:false,
				},
				created:function(){
					var tonight = getCookieValue("tonight");	// 读取在别的页面是否夜间模式来决定此页面是否为夜间模式
					 if(tonight!=null && tonight!=""){
						 this.noon=false;
						 this.night=true;
					}else{
						this.noon=true;
						this.night=false;
					}
					this.createCode();
				},
				methods: {
					checkInfo: function() {
						if (vm.name == "") {
							vm.tips = "请输入帐号！";
							vm.isRight = false;
						} else if (vm.name.length < 8 || vm.name.length > 15) {
							vm.tips = "账号长度必须为8-15个字符！";
							vm.isRight = false;
						} else {
							//账号合法，校验密码
							if (vm.password == "") {
								vm.tips = "请输入密码！";
								vm.isRight = false;
							} else if (vm.password.length < 8 || vm.password.length > 16) {
								vm.tips = "密码长度必须为8-16个字符！";
								vm.isRight = false;
							} else {
								if(vm.verify.length == 0||vm.verify==""){
								vm.tips="请输入验证码！";
								vm.isRight = false;
								}
								else if(vm.verify.toUpperCase() != code.toUpperCase()){
								 vm.tips="验证码输入有误！";
								 vm.isRight = false;
								 createCode();
								}
								else{
									vm.tips="";
									vm.isRight = true;
								
								}  
							}
						}
					},
					doSubmit: function() {
						if (vm.isRight) {
							setCookieValue("token","yes");
							setCookieValue("username",vm.name);
							console.log(getCookieValue("token"));
							this.$message('登陆成功');
							window.location.href = "home.html";
						} else {
							vm.tips = "请正确输入帐号和密码！";
						}
					},
					tonight:function(){
						if(vm.night){						// 因为监听器会随时监测night是否和tonight方向一致
							var space = "";					// 所以要先改变tonight的值再去改变night的值才能使night变化
							setCookieValue("tonight",space);	//不然night一变化就会被强制和tonight保持一致而恢复原来状态
							vm.night=false;							//就会产生不论怎么点击都无法改变的状况
							vm.noon=true;
						}else if(vm.noon){
							setCookieValue("tonight",vm.noon);
							vm.noon=false;
							vm.night=true;
					}
					
					},
					
					createCode:function (){
					 code = "";
					 var codeLength = 4; //验证码的长度
					 var checkCode = document.getElementById("checkCode");
					 var codeChars = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 
					   'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z',
					   'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'); //所有候选组成验证码的字符，当然也可以用中文的
					 for(var i = 0; i < codeLength; i++) 
					 {
					 var charNum = Math.floor(Math.random() * 52);
					 code += codeChars[charNum];
					 }
					 if(checkCode) 
					 {
					 checkCode.className = "code";
					 checkCode.innerHTML = code;
					 }
					},	
				},
				watch: {		// 随时监听night是否和cookie里的tonight方向一致，避免因F5刷新而导致的数据缺失
								// 从而导致night和tonight的不同步性
				
				   night() {
					   var isnight = getCookieValue("tonight");
					  if (isnight!=null && isnight!=""){
						  this.noon = false;
						  this.night = true;
					  }else{
						  this.noon = true;
						  this.night = false;
					  }
				   }
				
				},
			});
		</script>
		<script src="./js/particles.js"></script>
		<script src="./js/app.js"></script>

	</body>

</html>
